# Implementation Plan

- [ ] 1. 设置项目基础架构和开发环境
  - 创建React + TypeScript项目，配置Vite构建工具
  - 安装和配置shadcn/ui组件库和Tailwind CSS
  - 设置Python后端项目，使用uv管理依赖
  - 配置FastAPI框架和Strands Agent
  - 设置AWS开发环境和凭证配置
  - 配置Docker容器化环境
  - 初始化数据库结构（PostgreSQL on RDS）
  - **验证步骤**: 前端项目能正常启动并显示shadcn/ui组件，后端FastAPI服务能正常运行，数据库连接成功，AWS凭证配置正确
  - _Requirements: 5.1, 5.3_

- [ ] 2. 开发独立的ASR服务
- [ ] 2.1 创建ASR服务基础架构（Python）
  - 使用uv创建Python ASR服务项目
  - 安装FastAPI和WebSocket依赖
  - 设计ASR服务的API接口规范
  - 实现WebSocket服务器基础框架
  - **验证步骤**: ASR服务能正常启动，WebSocket端点可以接受连接，API接口文档生成正确
  - _Requirements: 5.2_

- [ ] 2.2 集成AWS Transcribe Streaming（Python）
  - 使用uv安装boto3和amazon-transcribe依赖
  - 实现AWS Transcribe Streaming客户端
  - 创建音频流处理和格式转换逻辑
  - 实现Transcribe连接管理和错误处理
  - **验证步骤**: 能成功建立与AWS Transcribe的连接，音频数据能正确转换格式并发送，能接收到转录结果
  - _Requirements: 1.2, 1.3, 5.2_

- [ ] 2.3 实现ASR服务的流式转录架构
  - 创建前端连接的WebSocket端点
  - 实现音频数据接收和转发到Transcribe
  - 处理转录结果的实时返回给前端输入框
  - 实现录音结束后的完整转录文本输出
  - 添加连接状态管理和心跳机制
  - **验证步骤**: 前端能成功连接WebSocket，音频数据能实时传输，转录结果能流式显示在输入框，录音结束后显示完整文本
  - _Requirements: 1.2, 1.3, 1.4_

- [ ] 3. 实现前端音频录制和ASR集成
- [ ] 3.1 实现基础音频录制功能（React + shadcn/ui）
  - 创建自定义useAudioRecorder React Hook
  - 使用MediaRecorder API和getUserMedia API实现录音功能
  - 使用shadcn/ui Button组件创建录音按钮
  - 实现音频格式转换（PCM 16kHz）
  - 创建录音状态管理和UI反馈
  - **验证步骤**: 点击录音按钮能获取麦克风权限，录音状态正确显示，音频能正确录制和格式转换
  - _Requirements: 1.1, 1.2, 7.6_

- [ ] 3.2 集成ASR服务WebSocket连接
  - 建立与ASR服务的WebSocket连接
  - 实现音频流实时传输到ASR服务
  - 处理连接断开重连机制
  - **验证步骤**: 前端能成功连接ASR服务WebSocket，音频数据能实时发送，连接异常时能自动重连
  - _Requirements: 1.2, 1.3_

- [ ] 3.3 处理实时转录结果显示
  - 接收和解析ASR服务返回的转录数据
  - 在文本输入框中流式显示转录内容
  - 实现转录完成后的文本确认和发送机制
  - **验证步骤**: 转录结果能实时显示在输入框中，用户能看到完整转录文本，点击发送后正常提交
  - _Requirements: 1.4, 7.2_

- [ ] 4. 开发Strands Agent核心功能
- [ ] 4.1 设置Strands Agent实时处理框架（Python + uv）
  - 使用uv安装strands-agents依赖
  - 初始化Strands Agent项目结构
  - 配置Agent基本信息和实时输入端点
  - 实现流式文本输入处理的基础架构
  - 创建会话状态管理机制
  - **验证步骤**: Strands Agent能正常启动，能接收文本输入，会话状态能正确管理，Agent能调用Claude模型
  - _Requirements: 5.3_

- [ ] 4.2 实现实时NLP信息提取工具
  - 使用Strands Agent默认的Amazon Bedrock Claude 3.7 Sonnet模型
  - 创建@tool装饰器函数用于流式文本分析
  - 实现累积转录文本的智能分段处理
  - 开发实时意图识别功能（增删改查操作）
  - 实现拜访信息的增量提取逻辑（时间、医生、药品、治疗观念）
  - 处理多个拜访记录和多个意图的实时识别
  - **验证步骤**: 能从测试文本中正确提取拜访信息，意图识别准确率达到90%以上，多个记录能正确分离
  - _Requirements: 1.3, 2.1, 2.2, 2.3_

- [ ] 4.3 实现医生治疗观念智能分类匹配
  - 定义预设的治疗观念层级类别枚举
  - 使用Claude 3.7 Sonnet进行治疗观念文本分类
  - 创建包含五层级详细描述的分类prompt
  - 实现分类结果的置信度评估和边界情况处理
  - **验证步骤**: 使用测试样本验证LLM分类准确率达到90%以上，分类结果一致性良好，边界情况处理正确
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 4.4 实现数据库操作工具
  - 创建拜访记录的CRUD操作工具
  - 实现数据验证和完整性检查
  - 开发复杂查询功能（按医生、时间、药品筛选）
  - **验证步骤**: 所有CRUD操作正常工作，数据验证能捕获错误输入，查询功能返回正确结果，数据完整性得到保证
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 5. 构建前端用户界面组件
- [ ] 5.1 实现主应用界面布局（React + shadcn/ui）
  - 使用shadcn/ui组件创建应用头部（标题、搜索、筛选按钮）
  - 使用Tailwind CSS实现响应式布局适配移动端
  - 添加PWA支持（Service Worker、Web App Manifest）
  - **验证步骤**: 界面在不同屏幕尺寸下正常显示，PWA能正常安装到主屏幕，离线功能正常工作
  - _Requirements: 7.1, 7.2_

- [ ] 5.2 开发对话消息显示组件（shadcn/ui）
  - 使用shadcn/ui ScrollArea组件实现消息列表
  - 创建自定义消息气泡组件（蓝色用户、灰色系统）
  - 使用Tailwind CSS实现消息样式和时间戳显示
  - 实现消息列表的自动滚动功能
  - **验证步骤**: 消息能正确显示不同样式，时间戳格式正确，新消息自动滚动到底部，长消息列表性能良好
  - _Requirements: 7.2_

- [ ] 5.3 创建拜访记录卡片组件（shadcn/ui）
  - 使用shadcn/ui Card组件实现可展开/收起的记录卡片
  - 使用shadcn/ui Badge组件添加标签显示（紫色药品、绿色治疗观念）
  - 使用Collapsible组件创建卡片展开后的详细信息显示
  - 添加Framer Motion动画效果
  - **验证步骤**: 卡片能正常展开收起，标签颜色正确显示，动画效果流畅，详细信息完整展示
  - _Requirements: 3.1, 3.2, 7.3, 7.4_

- [ ] 5.4 实现记录编辑和删除功能（shadcn/ui）
  - 使用shadcn/ui Form组件创建内联编辑表单
  - 使用shadcn/ui Input、Select组件实现字段编辑
  - 使用shadcn/ui AlertDialog组件添加删除确认对话框
  - 集成编辑和删除的API调用
  - **验证步骤**: 编辑表单能正确显示和提交，字段验证正常工作，删除确认对话框正常弹出，API调用成功
  - _Requirements: 3.3, 3.4, 7.5_

- [ ] 6. 集成前后端通信
- [ ] 6.1 实现REST API客户端
  - 创建与Strands Agent通信的API客户端
  - 实现错误处理和重试机制
  - 添加请求/响应的数据格式验证
  - **验证步骤**: API调用能正常发送和接收数据，错误情况能正确处理，重试机制正常工作，数据格式验证有效
  - _Requirements: 1.4, 2.1_

- [ ] 6.2 实现转录文本到Agent的数据传输
  - 实现用户点击发送后将转录文本发送给Strands Agent
  - 处理Agent返回的结构化数据
  - 实现消息气泡的显示逻辑（蓝色用户消息、灰色系统回复）
  - 创建记录卡片的显示机制
  - **验证步骤**: 点击发送后文本能正确发送给Agent，结构化数据能正确返回，消息气泡正确显示，记录卡片正常展示
  - _Requirements: 1.4, 2.1, 2.2_

- [ ] 6.3 实现记录管理的前后端集成
  - 集成查询、编辑、删除操作的API调用
  - 实现前端状态与后端数据的同步
  - 添加操作成功/失败的用户反馈
  - **验证步骤**: 所有CRUD操作能正常执行，前后端数据保持同步，用户能收到操作结果反馈，数据更新及时反映在界面上
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 7. 实现错误处理和用户体验优化
- [ ] 7.1 添加前端错误处理机制
  - 实现网络错误的用户友好提示
  - 添加录音权限错误的处理和引导
  - 创建数据验证错误的实时反馈
  - 处理ASR服务连接错误
  - **验证步骤**: 各种错误情况能正确捕获和显示，用户能理解错误信息并知道如何处理，错误恢复机制正常工作
  - _Requirements: 1.1_

- [ ] 7.2 实现ASR服务和后端错误处理
  - 添加ASR服务中Transcribe错误的处理机制
  - 实现Strands Agent中Bedrock Claude调用错误的降级策略
  - 处理Bedrock服务限流和超时错误
  - 创建完整的错误日志记录系统
  - **验证步骤**: 后端服务能正确处理各种错误情况，降级策略能正常工作，错误日志完整记录，服务稳定性良好
  - _Requirements: 5.3_

- [ ] 7.3 优化移动端用户体验
  - 实现触摸友好的交互设计
  - 添加录音状态的视觉反馈（动画效果）
  - 优化页面加载性能和响应速度
  - **验证步骤**: 在移动设备上操作流畅，触摸响应及时，录音动画效果明显，页面加载速度快于3秒
  - _Requirements: 7.6_

- [ ] 8. 部署和测试
- [ ] 8.1 配置AWS基础设施
  - 设置EC2实例和安全组配置
  - 配置RDS数据库和网络访问
  - 设置Application Load Balancer和SSL证书
  - **验证步骤**: EC2实例能正常访问，数据库连接正常，负载均衡器正常工作，SSL证书有效，安全组配置正确
  - _Requirements: 5.1, 5.2_

- [ ] 8.2 实现多服务Docker容器化部署
  - 创建ASR服务的Dockerfile和配置
  - 创建Strands Agent的Dockerfile和配置
  - 实现docker-compose多服务编排
  - 配置服务间网络通信和健康检查
  - **验证步骤**: 所有服务能正常启动，容器间网络通信正常，健康检查正常工作，服务能自动重启
  - _Requirements: 5.3_

- [ ] 8.3 编写端到端测试
  - 创建完整用户流程的自动化测试
  - 实现音频录制和ASR服务的集成测试
  - 添加Strands Agent和数据库操作的测试用例
  - **验证步骤**: 所有测试用例能正常运行，测试覆盖率达到80%以上，关键用户流程测试通过，性能测试达标
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 8.4 进行移动端兼容性测试
  - 在iOS Safari和Android Chrome上测试功能
  - 验证PWA功能的正常工作
  - 测试不同网络条件下的应用表现
  - 测试ASR服务的稳定性和性能
  - **验证步骤**: 在主流移动浏览器上功能正常，PWA能正常安装和使用，弱网环境下应用稳定，ASR服务响应时间小于2秒
  - _Requirements: 7.1, 7.2, 7.6_
